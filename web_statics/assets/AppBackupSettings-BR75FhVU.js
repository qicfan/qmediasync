import{d as B,r as g,o as $,w as M,a as r,b as m,c as b,e as t,f as u,g as j,h as S,i as q,_ as D,j as A,k as L,l as P,m as f,u as U,S as y,E as k,s as O,n as z,F as G,p as H,t as J,q as K}from"./index-CooZFtEb.js";const Q={class:"cron-selector"},W=B({__name:"CronSelector",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:d}){const p=E,o=d,s=g("0 2 * * *"),l=g(""),_=["0 2 * * *","0 3 * * *","0 */4 * * *","0 */12 * * *","0 0 * * 0"],V=n=>{n==="custom"?(l.value=p.modelValue||"0 2 * * *",o("update:modelValue",l.value)):o("update:modelValue",n)},C=()=>{o("update:modelValue",l.value)};return $(()=>{p.modelValue&&(_.includes(p.modelValue)?s.value=p.modelValue:(s.value="custom",l.value=p.modelValue))}),M(()=>p.modelValue,n=>{n&&(_.includes(n)?s.value!==n&&(s.value=n):(s.value!=="custom"||l.value!==n)&&(s.value="custom",l.value=n))}),(n,a)=>{const e=r("el-option"),v=r("el-select"),x=r("el-input");return m(),b("div",Q,[t(v,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=c=>s.value=c),placeholder:"选择定时策略",onChange:V,style:{width:"100%"}},{default:u(()=>[t(e,{label:"每天凌晨2点",value:"0 2 * * *"}),t(e,{label:"每天凌晨3点",value:"0 3 * * *"}),t(e,{label:"每4小时",value:"0 */4 * * *"}),t(e,{label:"每12小时",value:"0 */12 * * *"}),t(e,{label:"每周日凌晨",value:"0 0 * * 0"}),t(e,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"]),s.value==="custom"?(m(),j(x,{key:0,modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=c=>l.value=c),placeholder:"请输入 Cron 表达式，如: 0 2 * * *",onInput:C,style:{"margin-top":"12px"}},{prepend:u(()=>a[2]||(a[2]=[S("Cron")])),_:1},8,["modelValue"])):q("",!0)])}}}),X=D(W,[["__scopeId","data-v-2bfb9b46"]]),Y={class:"backup-settings-container"},Z={class:"page-header"},ee={key:0,class:"cron-next-times"},ae={class:"cron-times-list"},w=200,te=B({__name:"AppBackupSettings",setup(E){const d=A("$http"),p=K(),o=L({backup_enabled:1,backup_cron:"0 3 * * *",backup_retention:7,backup_max_count:10,backup_compress:1}),s=g(!1),l=g([]),_=g(!1),V=async()=>{if(d)try{const a=await d.get(`${y}/backup/config`);if(a.data.code===w&&a.data.data){const e=a.data.data,v=e.backup_cron||"0 3 * * *";Object.assign(o,{backup_enabled:e.backup_enabled,backup_cron:v,backup_retention:e.backup_retention,backup_max_count:e.backup_max_count,backup_compress:e.backup_compress}),await n()}}catch(a){const e=a instanceof Error?a.message:"加载备份配置失败";k.error(e)}},C=async()=>{if(d){s.value=!0;try{const a=await d.put(`${y}/backup/config`,o);a.data.code===w?(k.success("备份配置保存成功"),await n()):k.error(a.data.message||"保存配置失败")}catch(a){const e=a instanceof Error?a.message:"保存配置失败";k.error(e)}finally{s.value=!1}}},n=async()=>{if(!o.backup_cron||!d){l.value=[];return}try{_.value=!0;const a=await d.get(`${y}/setting/cron`,{params:{cron:o.backup_cron}});(a==null?void 0:a.data.code)===200&&a.data.data?l.value=a.data.data||[]:l.value=[]}catch(a){console.error("查询Cron执行时间错误:",a),l.value=[]}finally{_.value=!1}};return M(()=>o.backup_cron,a=>{a&&a.trim()?n():l.value=[]}),$(()=>{V()}),(a,e)=>{const v=r("el-icon"),x=r("el-switch"),c=r("el-form-item"),F=r("el-tag"),h=r("el-input-number"),I=r("el-button"),N=r("el-form"),R=P("loading");return m(),b("div",Y,[f("div",Z,[t(v,null,{default:u(()=>[t(U(O))]),_:1}),e[4]||(e[4]=f("span",null,"备份配置",-1))]),t(N,{ref:"configFormRef",model:o,"label-width":"120px","label-position":U(p)?"top":"right"},{default:u(()=>[t(c,{label:"启用自动备份"},{default:u(()=>[t(x,{modelValue:o.backup_enabled,"onUpdate:modelValue":e[0]||(e[0]=i=>o.backup_enabled=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t(c,{label:"定时策略",required:""},{default:u(()=>[t(X,{modelValue:o.backup_cron,"onUpdate:modelValue":e[1]||(e[1]=i=>o.backup_cron=i)},null,8,["modelValue"]),l.value.length>0?(m(),b("div",ee,[e[5]||(e[5]=f("p",null,[f("strong",null,"下5次执行时间：")],-1)),z((m(),b("div",ae,[(m(!0),b(G,null,H(l.value,(i,T)=>(m(),b("div",{key:T,class:"cron-time-item"},[t(F,{type:"info",size:"small"},{default:u(()=>[S(J(i),1)]),_:2},1024)]))),128))])),[[R,_.value]])])):q("",!0)]),_:1}),t(c,{label:"保留天数",required:""},{default:u(()=>[t(h,{modelValue:o.backup_retention,"onUpdate:modelValue":e[2]||(e[2]=i=>o.backup_retention=i),min:1,max:365,"controls-position":"right"},null,8,["modelValue"]),e[6]||(e[6]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"天",-1))]),_:1}),t(c,{label:"最大备份数",required:""},{default:u(()=>[t(h,{modelValue:o.backup_max_count,"onUpdate:modelValue":e[3]||(e[3]=i=>o.backup_max_count=i),min:1,max:100,"controls-position":"right"},null,8,["modelValue"]),e[7]||(e[7]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"个",-1))]),_:1}),t(c,null,{default:u(()=>[t(I,{type:"primary",loading:s.value,onClick:C},{default:u(()=>e[8]||(e[8]=[S(" 保存配置 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","label-position"])])}}}),le=D(te,[["__scopeId","data-v-bfc0af26"]]);export{le as default};
