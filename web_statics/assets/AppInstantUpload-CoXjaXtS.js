import{d as J,i as G,r as v,a as K,b as d,c as g,e as t,w as s,o as f,f as l,u as D,g as Q,h as a,t as B,j as A,k as W,l as X,m as Y,n as Z,F as ee,p as le,q as te,s as se,S as T,E as L,_ as ae}from"./index-Dqp3gZ1f.js";const oe={class:"instant-upload-container"},ne={class:"upload-content"},ie={class:"upload-section"},re={class:"section-title"},ue={class:"dir-selector-inline"},de={key:0,class:"selected-path-inline"},ce={class:"path-url"},pe={key:1,class:"progress-section"},ve={class:"progress-text"},fe={class:"usage-content"},_e={class:"usage-section"},me={class:"usage-section"},ge={class:"dir-selector"},be={key:0,class:"loading-container"},he={key:1,class:"empty-container"},ye={key:2,class:"dir-list"},ke=["onClick"],we={class:"dir-name"},De={key:0,class:"selected-dir-section"},Ee={class:"selected-dir-info"},$e={class:"selected-dir-path"},Ce={class:"dialog-footer"},xe=J({__name:"AppInstantUpload",setup(Ue){const w=G("$http"),k=v(!1),_=v(null),o=v({visible:!1,percentage:0,status:void 0,text:""}),b=K({file_list:""}),E=v(!1),R=v([]),V=v(!1),h=v(null),z=v(null),$=v(""),C=v(""),I=async()=>{var n,e;if(j())try{k.value=!0,_.value=null,o.value.visible=!0,o.value.percentage=0,o.value.text="准备批量上传...";const c={file_list:b.file_list.trim().split(`
`).map(r=>r.trim()).filter(r=>r.length>0),root_dir_id:C.value,root_dir_path:$.value};o.value.percentage=50,o.value.text="正在处理批量文件...";const i=await(w==null?void 0:w.post(`${T}/upload/batch-instant`,c,{headers:{"Content-Type":"application/json"}}));if(o.value.percentage=100,(i==null?void 0:i.data.code)===200){o.value.status="success",o.value.text="批量秒传完成！";const r=((n=i.data.data)==null?void 0:n.success_count)||0,y=((e=i.data.data)==null?void 0:e.total_count)||0;_.value={title:"批量秒传完成",type:r===y?"success":"warning",description:`共处理 ${y} 个文件，成功 ${r} 个，失败 ${y-r} 个`},L.success(`批量秒传完成！成功 ${r}/${y} 个文件`),b.file_list=""}else o.value.status="exception",o.value.text="批量秒传失败",_.value={title:"批量秒传失败",type:"error",description:(i==null?void 0:i.data.message)||"批量秒传过程中发生错误，请检查文件列表格式"}}catch(u){console.error("批量秒传错误:",u),o.value.status="exception",o.value.text="批量秒传失败",_.value={title:"批量秒传出错",type:"error",description:"批量秒传过程中发生网络错误，请检查网络连接"}}finally{k.value=!1,setTimeout(()=>{o.value.visible=!1},3e3)}},j=()=>{if(!C.value||!$.value)return L.warning("请选择115网盘根目录"),!1;if(!b.file_list.trim())return L.warning("请输入文件列表"),!1;const n=b.file_list.trim().split(`
`),e=[];return n.forEach((u,m)=>{const c=u.trim();if(c)try{const i=new URL(c);if(!i.pathname.includes("/115/url")){e.push(m+1);return}const r=i.searchParams,y=r.get("name"),F=r.get("pick_code"),x=r.get("sha1"),U=r.get("size");if(!y||!F||!x||!U){e.push(m+1);return}if(!/^[a-fA-F0-9]{40}$/i.test(x)){e.push(m+1);return}if(!/^\d+$/.test(U)){e.push(m+1);return}}catch{e.push(m+1);return}}),e.length>0?(L.warning(`第 ${e.join(", ")} 行URL格式不正确`),!1):!0},M=()=>{b.file_list="",_.value=null,o.value.visible=!1},N=async()=>{E.value=!0,h.value=null,z.value=null,await S("0")},S=async n=>{try{V.value=!0;const e=await(w==null?void 0:w.get(`${T}/115/dir-path`,{params:{parent_id:n}}));(e==null?void 0:e.data.code)===200&&(R.value=e.data.data||[])}catch(e){console.error("加载目录树错误:",e)}finally{V.value=!1}},P=async n=>{h.value=n,z.value=n,await S(n.id)},q=async()=>{if(!h.value)return;const n=h.value;C.value=n.id,$.value=n.path||n.name,E.value=!1};return(n,e)=>{const u=d("el-icon"),m=d("el-input"),c=d("el-button"),i=d("el-form-item"),r=d("el-form"),y=d("el-alert"),F=d("el-progress"),x=d("el-card"),U=d("el-code"),O=d("el-scrollbar"),H=d("el-dialog");return f(),g("div",oe,[t(x,{class:"instant-upload-card",shadow:"hover"},{header:s(()=>e[4]||(e[4]=[l("h2",{class:"card-title"},"秒传功能",-1),l("p",{class:"card-subtitle"},"通过文件哈希值快速上传文件到115网盘",-1)])),default:s(()=>[l("div",ne,[l("div",ie,[l("h3",re,[t(u,null,{default:s(()=>[t(D(Q))]),_:1}),e[5]||(e[5]=a(" 批量秒传 "))]),e[12]||(e[12]=l("p",{class:"section-description"},"通过文本格式批量上传多个文件",-1)),t(r,{model:b,"label-position":"top",class:"upload-form"},{default:s(()=>[t(i,{label:"115网盘根目录"},{default:s(()=>[l("div",ue,[t(m,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=p=>C.value=p),placeholder:"目录ID",disabled:k.value,style:{width:"200px","margin-right":"12px"}},null,8,["modelValue","disabled"]),t(c,{type:"primary",onClick:N,disabled:k.value},{default:s(()=>e[6]||(e[6]=[a(" 选择目录 ")])),_:1},8,["disabled"])]),$.value?(f(),g("div",de,[e[7]||(e[7]=l("span",{class:"path-label"},"选中目录路径：",-1)),l("code",ce,B($.value),1)])):A("",!0),e[8]||(e[8]=l("div",{class:"form-help"},"选择115网盘中的根目录，文件将上传到此目录下",-1))]),_:1}),t(i,{label:"文件列表",required:""},{default:s(()=>[t(m,{modelValue:b.file_list,"onUpdate:modelValue":e[1]||(e[1]=p=>b.file_list=p),type:"textarea",rows:10,placeholder:"请按照指定URL格式输入文件信息，每行一个URL",disabled:k.value},null,8,["modelValue","disabled"]),e[9]||(e[9]=l("div",{class:"form-help"},[a(" 格式：http://ip:port/115/url?name=$path&pick_code=$pick_code&sha1=$sha1&size=$size"),l("br"),a(" 示例："),l("br"),a(" http://192.168.1.10:12333/115/url?name=%E7%94%B5%E8%A7%86%E5%89%A7%2F%E5%9B%BD%E4%BA%A7%E5%89%A7%2F%E9%97%AE%E5%BF%83%2F%E9%97%AE%E5%BF%83+01.mp4&pick_code=azg8910t6xesohfw6&sha1=22938B78CD5E8EB4D82A3181CD1ED210B2C06F25&size=5249192463"),l("br"),a(" 注意：文件路径需要进行URL编码 ")],-1))]),_:1}),t(i,null,{default:s(()=>[t(c,{type:"success",onClick:I,loading:k.value,size:"large"},{default:s(()=>[t(u,null,{default:s(()=>[t(D(W))]),_:1}),e[10]||(e[10]=a(" 批量秒传 "))]),_:1},8,["loading"]),t(c,{type:"warning",onClick:M,disabled:k.value,size:"large"},{default:s(()=>[t(u,null,{default:s(()=>[t(D(X))]),_:1}),e[11]||(e[11]=a(" 重置表单 "))]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_.value?(f(),Y(y,{key:0,title:_.value.title,type:_.value.type,description:_.value.description,closable:!1,"show-icon":"",class:"upload-status"},null,8,["title","type","description"])):A("",!0),o.value.visible?(f(),g("div",pe,[e[13]||(e[13]=l("h4",null,"上传进度",-1)),t(F,{percentage:o.value.percentage,status:o.value.status,"show-text":!0},null,8,["percentage","status"]),l("p",ve,B(o.value.text),1)])):A("",!0)])]),_:1}),t(x,{class:"usage-card",shadow:"hover"},{header:s(()=>e[14]||(e[14]=[l("h2",{class:"card-title"},"使用说明",-1),l("p",{class:"card-subtitle"},"如何获取URL",-1)])),default:s(()=>[l("div",fe,[e[24]||(e[24]=l("div",{class:"usage-section notice-section"},[l("h4",null,"注意事项："),l("p",null," 文件将被上传到115网盘根目录+name，比如115网盘根目录选择了Media，name=电影/国产电影/哪吒(2015)/哪吒.mkv，那么该文件将被上传到/Media/电影/国产电影/哪吒(2015)/哪吒.mkv，如果路径不存在则会自动创建。 ")],-1)),l("div",_e,[e[16]||(e[16]=l("h4",null,"URL格式说明：",-1)),e[17]||(e[17]=l("p",null,"每行包含一个完整的115文件URL，格式如下：",-1)),t(U,{class:"code-block"},{default:s(()=>e[15]||(e[15]=[a(" http://ip:port/115/url?name=$path&pick_code=$pick_code&sha1=$sha1&size=$size ")])),_:1}),e[18]||(e[18]=l("ul",null,[l("li",null,[l("strong",null,"ip:port："),a("服务器地址和端口")]),l("li",null,[l("strong",null,"name："),a("文件路径")]),l("li",null,[l("strong",null,"pick_code："),a("115网盘文件提取码")]),l("li",null,[l("strong",null,"sha1："),a("文件SHA1哈希值（40位十六进制）")]),l("li",null,[l("strong",null,"size："),a("文件大小（字节）")])],-1))]),e[25]||(e[25]=l("div",{class:"usage-section"},[l("h4",null,"如何获取URL："),l("p",null,"请使用本项目生成的STRM文件的内容")],-1)),l("div",me,[e[20]||(e[20]=l("h4",null,"接口数据格式：",-1)),e[21]||(e[21]=l("p",null,"提交时会发送以下参数：",-1)),e[22]||(e[22]=l("ul",null,[l("li",null,[l("strong",null,"file_list："),a("JSON格式的字符串数组，包含所有URL")]),l("li",null,[l("strong",null,"root_dir_id："),a("115网盘根目录ID")]),l("li",null,[l("strong",null,"root_dir_path："),a("115网盘根目录路径")])],-1)),e[23]||(e[23]=l("p",null,"示例：",-1)),t(U,{class:"code-block"},{default:s(()=>e[19]||(e[19]=[a(' file_list: ["http://ip:port/115/url?name=file1...", "http://ip:port/115/url?name=file2..."]'),l("br",null,null,-1),a(' root_dir_id: "123456789"'),l("br",null,null,-1),a(' root_dir_path: "/Media" ')])),_:1})])])]),_:1}),t(H,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=p=>E.value=p),title:"选择115网盘目录",width:"60%","close-on-click-modal":!1},{footer:s(()=>[l("span",Ce,[t(c,{onClick:e[2]||(e[2]=p=>E.value=!1)},{default:s(()=>e[29]||(e[29]=[a("取消")])),_:1}),t(c,{type:"primary",onClick:q,disabled:!h.value},{default:s(()=>e[30]||(e[30]=[a(" 确定选择 ")])),_:1},8,["disabled"])])]),default:s(()=>[l("div",ge,[t(O,{height:"400px"},{default:s(()=>[V.value?(f(),g("div",be,[t(u,{class:"is-loading"},{default:s(()=>[t(D(Z))]),_:1}),e[26]||(e[26]=l("p",null,"加载中...",-1))])):R.value.length===0?(f(),g("div",he,e[27]||(e[27]=[l("p",null,"暂无目录",-1)]))):(f(),g("div",ye,[(f(!0),g(ee,null,le(R.value,p=>(f(),g("div",{key:p.id,class:"dir-item",onClick:Be=>P(p)},[t(u,null,{default:s(()=>[t(D(te))]),_:1}),l("span",we,B(p.name),1),t(u,{class:"enter-icon"},{default:s(()=>[t(D(se))]),_:1})],8,ke))),128))]))]),_:1}),h.value?(f(),g("div",De,[l("div",Ee,[e[28]||(e[28]=l("div",{class:"selected-dir-label"},"当前选中目录：",-1)),l("div",$e,B(h.value.path||h.value.name),1)])])):A("",!0)])]),_:1},8,["modelValue"])])}}}),Le=ae(xe,[["__scopeId","data-v-7e0c9400"]]);export{Le as default};
